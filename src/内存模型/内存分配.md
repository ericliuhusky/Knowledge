# 内存分配

## 静态内存分配

```swift
let a = 0

struct S {
    static let a = 0
}
```

```rust
static mut A: usize = 0;
```

```c
static int a = 0;
```

```asm
// arm64, AT&T

    .data
_a:
    .quad 0
```

## 栈内存分配

```swift
struct S {
    let a: Int
    let b: Int
    let c: Int
}

let a = 0
let s = S(a: 1, b: 2, c: 3)
```

```rust
struct S {
    a: i32,
    b: i32,
    c: i32,
}

let a = 0;
let s = S { a: 1, b: 2, c: 3 };
```

```c
struct S {
    int a;
    int b;
    int c;
};

int a = 0;
struct S s = {1, 2, 3};
```

```asm
// arm64, AT&T

_main:
    sub sp, sp, #64
    stp x29, x30, [sp, #48]
    add x29, sp, #48


    // int a = 0;
    mov w8, #0
    str w8, [x29, #-4*1]

    // struct S s = {1, 2, 3};
    mov w8, #1
    str w8, [x29, #-4*4]
    mov w8, #2
    str w8, [x29, #-4*3]
    mov w8, #3
    str w8, [x29, #-4*2]


    ldp x29, x30, [sp, #48]
    add sp, sp, #64

    ret
```

## 堆内存分配

```swift
class C {
    let a: Int
    
    init(a: Int) {
        self.a = a
    }
}

let c = C(a: 1)
```

```rust
struct C {
    a: i32,
}

let c = Box::new(C { a: 1 });
```

```c
struct C {
    int a;
};

struct C *c = malloc(sizeof(struct C));
c->a = 1;
```

```asm
// arm64, AT&T

_main:
    sub sp, sp, #64
    stp x29, x30, [sp, #48]
    add x29, sp, #48


    // struct C *c = malloc(sizeof(struct C));
    mov	x0, #4
    bl _malloc
    str x0, [x29, #-8]

    // c->a = 1;
    mov w8, #1
    ldr x9, [x29, #-8]
    str w8, [x9]


    ldp x29, x30, [sp, #48]
    add sp, sp, #64

    ret
```
