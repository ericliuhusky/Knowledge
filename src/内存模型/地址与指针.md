# 地址与指针

## UnsafePointer

```swift
let a: Int32 = 3
let ptr = withUnsafePointer(to: a) { $0 }
let addr = UInt(bitPattern: ptr)
print(String(addr, radix: 16))
let ptr2 = UnsafePointer<Int32>(bitPattern: addr)!
let a2 = ptr2.pointee
print(a2)
```

```rust
let a: i32 = 3;
let ptr = &a as *const i32;
let addr = ptr as usize;
println!("{:#x}", addr);
let ptr = addr as *const i32;
let a = unsafe { *ptr };
println!("{}", a);
```

```c
const int a = 3;
const int *ptr = &a;
const long long addr = (long long)ptr;
printf("%llx\n", addr);
const int *ptr2 = (int*)addr;
const int a2 = *ptr2;
printf("%d\n", a2);
```

```asm
// arm64, AT&T

sub sp, sp, #64
stp x29, x30, [sp, #48]
add x29, sp, #48


// int a = 3;
mov w8, #3
str w8, [x29, #-4]

// int *ptr = &a;
sub x8, x29, #4
str x8, [x29, #-16]

// const long long addr = (long long)ptr;
ldr x8, [x29, #-16]
str x8, [x29, #-24]

// const int *ptr2 = (int*)addr;
ldr x8, [x29, #-24]
str x8, [x29, #-32]

// const int a2 = *ptr2;
ldr x8, [x29, #-32]
ldr w8, [x8]
str w8, [x29, #-36]


ldp x29, x30, [sp, #48]
add sp, sp, #64
```
