# 程序的机器级表示

## 条件分支

```c
int abs(int a, int b) {
    if (a > b) {
        return a - b;
    } else {
        return b - a;
    }
}
```

### 条件控制

```asm
_abs:
    cmpl    %esi, %edi
    jle     L2
    movl    %edi, %eax
    subl    %esi, %eax
    ret
L2:
    movl    %esi, %eax
    subl    %edi, %eax
    ret
```

### 条件传送

```asm
_abs:
    movl    %edi, %eax
    subl    %esi, %eax
    movl    %esi, %edx
    subl    %edi, %edx
    cmpl    %esi, %edi
    cmovle  %edx, %eax
    ret
```

## 循环

### do-while

```c
int sum(int n) {
    int res = 0;
    do {
        res += n;
        n -= 1;
    } while (n > 0);
    return res;
}
```

```asm
_sum:
    movl    $0, %eax
LOOP:
    addl    %edi, %eax
    subl    $1, %edi
    cmpl    $0, %edi
    jg      LOOP
    ret
```

### while

```c
int sum(int n) {
    int res = 0;
    while (n > 0) {
        res += n;
        n -= 1;
    }
    return res;
}
```

### for

```c
int sum(int n) {
    int res = 0;
    for (; n > 0; n--) {
        res += n;
    }
    return res;
}
```

### while 和 for循环jump to middle汇编实现

```asm
_sum:
    movl    $0, %eax
    jmp     TEST
LOOP:
    addl    %edi, %eax
    subl    $1, %edi
TEST:
    cmpl    $0, %edi
    jg      LOOP
    ret
```

### while 和 for循环guarded-do汇编实现

```asm
_sum:
    movl    $0, %eax
    cmpl    $0, %edi
    jle     DONE
LOOP:
    addl    %edi, %eax
    subl    $1, %edi
    cmpl    $0, %edi
    jne     LOOP
    ret
DONE:
    ret
```
